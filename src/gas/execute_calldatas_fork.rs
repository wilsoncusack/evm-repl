use dotenv::dotenv;
use std::env;

use alloy::providers::{Provider, ProviderBuilder};
use alloy_eips::BlockId;
use alloy_primitives::{Address, Bytes, Log, U256};
use alloy_rpc_types_eth::BlockTransactionsKind;
use forge::{
    backend::{self, DatabaseExt},
    executors::ExecutorBuilder,
    opts::EvmOpts,
    traces::CallTraceArena,
};
use foundry_config::Config;
use revm::{interpreter::InstructionResult, primitives::TxEnv, DatabaseCommit, InnerEvmContext};
use revm_primitives::{AccountInfo, BlockEnv, Bytecode, CfgEnv, Env};
use serde::{Deserialize, Serialize};

use crate::gas::transact;

#[derive(Deserialize, Clone)]
pub struct Call {
    pub calldata: Bytes,
    pub value: U256,
    pub caller: Address,
}

#[derive(Deserialize, Serialize, Debug)]
#[serde(rename_all = "camelCase")]
pub struct ExecutionResult {
    pub exit_reason: InstructionResult,
    pub reverted: bool,
    pub result: Bytes,
    pub gas_used: u64,
    pub logs: Vec<Log>,
    pub traces: CallTraceArena,
}

pub async fn execute_calldatas_fork(
    deployed_bytes: Bytes,
    address: Address,
    calls: Vec<Call>,
) -> Result<Vec<ExecutionResult>, eyre::Error> {
    dotenv().ok();
    let rpc =
        env::var("BASE_RPC").map_err(|_| eyre::eyre!("BASE_RPC environment variable not set"))?;
    let rpc_url = rpc.parse()?;
    let provider = ProviderBuilder::new().on_http(rpc_url);
    let (_fork_gas_price, rpc_chain_id, block) = tokio::try_join!(
        provider.get_gas_price(),
        provider.get_chain_id(),
        provider.get_block(BlockId::latest(), BlockTransactionsKind::Hashes)
    )?;
    let cfg = CfgEnv::default().with_chain_id(rpc_chain_id);

    let block = if let Some(block) = block {
        block
    } else {
        Err(eyre::eyre!("block not found"))?
    };
    let block_env = BlockEnv {
        number: U256::from(block.header.number.expect("block number not found")),
        timestamp: U256::from(block.header.timestamp),
        coinbase: block.header.miner,
        difficulty: block.header.difficulty,
        prevrandao: Some(block.header.mix_hash.unwrap_or_default()),
        basefee: U256::from(block.header.base_fee_per_gas.unwrap_or_default()),
        gas_limit: U256::from(block.header.gas_limit),
        ..Default::default()
    };
    let env = Env {
        cfg,
        block: block_env,
        tx: TxEnv {
            chain_id: Some(rpc_chain_id),
            gas_limit: block.header.gas_limit as u64,
            ..Default::default()
        },
        ..Default::default()
    };
    let opts = EvmOpts {
        fork_url: Some(rpc),
        ..Default::default()
    };
    let backend = backend::Backend::spawn(opts.get_fork(&Config::default(), opts.evm_env().await?));
    let mut executor = ExecutorBuilder::new()
        .inspectors(|stack| stack.trace_mode(forge::traces::TraceMode::Call).logs(true))
        .build(env, backend);

    let deployed_bytecode = Bytecode::new_raw(deployed_bytes);
    executor.backend_mut().insert_account_info(
        address,
        AccountInfo {
            code_hash: deployed_bytecode.hash_slow(),
            code: Some(deployed_bytecode),
            ..Default::default()
        },
    );

    calls
        .into_iter()
        .map(|call| {
            let r = executor.transact_raw(call.caller, address, call.calldata, call.value)?;
            Ok(ExecutionResult {
                exit_reason: r.exit_reason,
                reverted: r.reverted,
                result: r.result,
                gas_used: r.gas_used,
                logs: r.logs,
                traces: r.traces.unwrap_or(CallTraceArena::default()),
            })
        })
        .collect()
}

#[cfg(test)]
mod tests {
    use super::*;
    use alloy::hex;
    use alloy_primitives::{Address, Bytes, U256};
    use std::str::FromStr;

    #[tokio::test(flavor = "multi_thread")]
    async fn test_execute_calldatas_fork() {
        // Setup
        let bytecode = Bytes::from_str("0x608060405234801561000f575f80fd5b50600436106103ad575f3560e01c80636d73e669116101f2578063b0fe87c911610118578063d5a06d4c116100ab578063f0cdc4991161007a578063f0cdc49914610bb6578063f2fde38b14610bd2578063fe2e1f5814610bee578063ffa1ad7414610c1e576103ad565b8063d5a06d4c14610b09578063e00aab4b14610b3a578063e92a89f614610b6a578063e985e9c514610b86576103ad565b8063bb3bafd6116100e7578063bb3bafd614610a5c578063c87b56dd14610a8d578063ce8aee9d14610abd578063d397371914610ad9576103ad565b8063b0fe87c9146109c4578063b4b5b48f146109e0578063b88d4fde14610a10578063b9c4d9fb14610a2c576103ad565b806383b7db6311610190578063a22cb4651161015f578063a22cb46514610940578063aafb2d441461095c578063ac0c8cfa14610978578063ad2d0ddd14610994576103ad565b806383b7db63146108ca5780638da5cb5b146108e857806395d89b411461090657806399e0dd7c14610924576103ad565b806372ff03d3116101cc57806372ff03d31461081e5780637884af441461084e5780637aa15f161461087e57806382dcc0c8146108ae576103ad565b80636d73e669146107c857806370a08231146107e4578063715018a614610814576103ad565b806330176e13116102d75780634278330e11610275578063596798ad11610244578063596798ad1461074457806361e5bc6b146107605780636352211e1461077c57806366d1e9d0146107ac576103ad565b80634278330e146106c057806342842e0e146106f057806342966c681461070c5780634cd88b7614610728576103ad565b8063332dd1ae116102b1578063332dd1ae1461063c57806338e52e78146106585780633e6134b8146106885780633f0f37f6146106a4576103ad565b806330176e13146105e65780633071a0f91461060257806331ae450b1461061e576103ad565b806320e4afe21161034f57806324d7806c1161031e57806324d7806c146105395780632928ca58146105695780632a55205a146105995780632d345670146105ca576103ad565b806320e4afe2146104b357806322f374d0146104cf578063239be317146104ed57806323b872dd1461051d576103ad565b8063081812fc1161038b578063081812fc1461041b578063095ea7b31461044b5780630ebd4c7f14610467578063162094c414610497576103ad565b806301ffc9a7146103b157806302e7afb7146103e157806306fdde03146103fd575b5f80fd5b6103cb60048036038101906103c69190616db0565b610c3c565b6040516103d89190616df5565b60405180910390f35b6103fb60048036038101906103f69190616e68565b610c6d565b005b610405610d09565b6040516104129190616f03565b60405180910390f35b61043560048036038101906104309190616f56565b610d99565b6040516104429190616f90565b60405180910390f35b61046560048036038101906104609190616fa9565b610ddb565b005b610481600480360381019061047c9190616f56565b610ee3565b60405161048e919061709e565b60405180910390f35b6104b160048036038101906104ac919061711f565b610f3d565b005b6104cd60048036038101906104c89190617226565b610fdd565b005b6104d76110c9565b6040516104e49190616f90565b60405180910390f35b61050760048036038101906105029190616f56565b6110f1565b6040516105149190616f90565b60405180910390f35b610537600480360381019061053291906172b7565b61120c565b005b610553600480360381019061054e9190616e68565b611265565b6040516105609190616df5565b60405180910390f35b610583600480360381019061057e9190616e68565b6112be565b6040516105909190617316565b60405180910390f35b6105b360048036038101906105ae919061732f565b6112f8565b6040516105c192919061736d565b60405180910390f35b6105e460048036038101906105df9190616e68565b611357565b005b61060060048036038101906105fb9190617394565b6113eb565b005b61061c600480360381019061061791906173df565b611489565b005b610626611533565b60405161063391906174f3565b60405180910390f35b61065660048036038101906106519190617513565b61160e565b005b610672600480360381019061066d91906175e6565b6116b1565b60405161067f919061709e565b60405180910390f35b6106a2600480360381019061069d9190617394565b611803565b005b6106be60048036038101906106b9919061766d565b61181a565b005b6106da60048036038101906106d59190617733565b6118c5565b6040516106e7919061709e565b60405180910390f35b61070a600480360381019061070591906172b7565b6119e6565b005b61072660048036038101906107219190616f56565b611a05565b005b610742600480360381019061073d91906178b8565b611a8f565b005b61075e60048036038101906107599190616e68565b611bd3565b005b61077a6004803603810190610775919061792e565b611c6f565b005b61079660048036038101906107919190616f56565b611d25565b6040516107a39190616f90565b60405180910390f35b6107c660048036038101906107c19190617394565b611dd3565b005b6107e260048036038101906107dd9190616e68565b611de9565b005b6107fe60048036038101906107f99190616e68565b611e7c565b60405161080b9190617316565b60405180910390f35b61081c611f30565b005b61083860048036038101906108339190616e68565b611f43565b6040516108459190617316565b60405180910390f35b610868600480360381019061086391906173df565b612004565b6040516108759190617316565b60405180910390f35b610898600480360381019061089391906175e6565b6120fc565b6040516108a5919061709e565b60405180910390f35b6108c860048036038101906108c391906179ac565b6122d5565b005b6108d26122ed565b6040516108df91906174f3565b60405180910390f35b6108f06123c6565b6040516108fd9190616f90565b60405180910390f35b61090e6123ee565b60405161091b9190616f03565b60405180910390f35b61093e60048036038101906109399190617394565b61247e565b005b61095a60048036038101906109559190617a09565b61251c565b005b6109766004803603810190610971919061792e565b61252b565b005b610992600480360381019061098d9190617a47565b612669565b005b6109ae60048036038101906109a99190617aa9565b61267e565b6040516109bb919061709e565b60405180910390f35b6109de60048036038101906109d99190617ae7565b612801565b005b6109fa60048036038101906109f59190616f56565b6128a5565b604051610a079190617b9c565b60405180910390f35b610a2a6004803603810190610a259190617c53565b6128eb565b005b610a466004803603810190610a419190616f56565b612946565b604051610a539190617d9b565b60405180910390f35b610a766004803603810190610a719190616f56565b6129a0565b604051610a84929190617dbb565b60405180910390f35b610aa76004803603810190610aa29190616f56565b6129fd565b604051610ab49190616f03565b60405180910390f35b610ad76004803603810190610ad29190616e68565b612a57565b005b610af36004803603810190610aee9190617e1a565b612af3565b604051610b009190617316565b60405180910390f35b610b236004803603810190610b1e9190616f56565b612b2e565b604051610b31929190617dbb565b60405180910390f35b610b546004803603810190610b4f9190617aa9565b612b8b565b604051610b61919061709e565b60405180910390f35b610b846004803603810190610b7f919061711f565b612c87565b005b610ba06004803603810190610b9b9190617e58565b612c9f565b604051610bad9190616df5565b60405180910390f35b610bd06004803603810190610bcb9190617e58565b612d2d565b005b610bec6004803603810190610be79190616e68565b612dcb565b005b610c086004803603810190610c0391906173df565b612e4d565b604051610c159190617316565b60405180910390f35b610c26612ebe565b604051610c339190617316565b60405180910390f35b5f610c4682612ec3565b80610c565750610c5582612f8b565b5b80610c665750610c658261306c565b5b9050919050565b3373ffffffffffffffffffffffffffffffffffffffff16610c8c6123c6565b73ffffffffffffffffffffffffffffffffffffffff161480610cbe5750610cbd3360666130e590919063ffffffff16565b5b610cfd576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cf490617f06565b60405180910390fd5b610d0681613112565b50565b606060688054610d1890617f51565b80601f0160208091040260200160405190810160405280929190818152602001828054610d4490617f51565b8015610d8f5780601f10610d6657610100808354040283529160200191610d8f565b820191905f5260205f20905b815481529060010190602001808311610d7257829003601f168201915b5050505050905090565b5f610da3826132cd565b606c5f8381526020019081526020015f205f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b5f610de582611d25565b90508073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610e55576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e4c90617ff1565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480610e955750610e948133612c9f565b5b610ed4576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610ecb9061807f565b60405180910390fd5b610ede8383613318565b505050565b6060610eee826133ce565b610f2d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f24906180e7565b60405180910390fd5b610f3682613438565b9050919050565b3373ffffffffffffffffffffffffffffffffffffffff16610f5c6123c6565b73ffffffffffffffffffffffffffffffffffffffff161480610f8e5750610f8d3360666130e590919063ffffffff16565b5b610fcd576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610fc490617f06565b60405180910390fd5b610fd883838361344e565b505050565b3373ffffffffffffffffffffffffffffffffffffffff16610ffc6123c6565b73ffffffffffffffffffffffffffffffffffffffff16148061102e575061102d3360666130e590919063ffffffff16565b5b61106d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161106490617f06565b60405180910390fd5b611076856133ce565b6110b5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110ac906180e7565b60405180910390fd5b6110c28585858585613503565b5050505050565b5f606f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b5f6110fb826133ce565b61113a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611131906180e7565b60405180910390fd5b6111438261358d565b90505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036111b3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016111aa9061814f565b60405180910390fd5b6111c78160726130e590919063ffffffff16565b15611207576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016111fe906181b7565b60405180910390fd5b919050565b6112163382613613565b611255576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161124c90618245565b60405180910390fd5b6112608383836136a7565b505050565b5f8173ffffffffffffffffffffffffffffffffffffffff166112856123c6565b73ffffffffffffffffffffffffffffffffffffffff1614806112b757506112b68260666130e590919063ffffffff16565b5b9050919050565b5f6112c76139ae565b6112cf6139fd565b6112e98260405180602001604052805f8152505f80613a52565b90506112f3613b34565b919050565b5f80611303846133ce565b611342576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611339906180e7565b60405180910390fd5b61134c8484613b3e565b915091509250929050565b61135f613c05565b6113738160666130e590919063ffffffff16565b156113e8573373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f7c0c3c84c67c85fcac635147348bfe374c24a1a93d0366d1cfe9d8853cbf89d560405160405180910390a36113e6816066613c8390919063ffffffff16565b505b50565b3373ffffffffffffffffffffffffffffffffffffffff1661140a6123c6565b73ffffffffffffffffffffffffffffffffffffffff16148061143c575061143b3360666130e590919063ffffffff16565b5b61147b576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161147290617f06565b60405180910390fd5b6114858282613cb0565b5050565b3373ffffffffffffffffffffffffffffffffffffffff166114a86123c6565b73ffffffffffffffffffffffffffffffffffffffff1614806114da57506114d93360666130e590919063ffffffff16565b5b611519576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161151090617f06565b60405180910390fd5b61152283613d01565b61152e8383835f613d58565b505050565b606061153f6066613f18565b67ffffffffffffffff81111561155857611557617794565b5b6040519080825280602002602001820160405280156115865781602001602082028036833780820191505090505b5090505f5b6115956066613f18565b81101561160a576115b0816066613f2b90919063ffffffff16565b8282815181106115c3576115c2618263565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050808060010191505061158b565b5090565b3373ffffffffffffffffffffffffffffffffffffffff1661162d6123c6565b73ffffffffffffffffffffffffffffffffffffffff16148061165f575061165e3360666130e590919063ffffffff16565b5b61169e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161169590617f06565b60405180910390fd5b6116ab5f85858585613f42565b50505050565b60606116bb6139ae565b6116c36139fd565b8282905067ffffffffffffffff8111156116e0576116df617794565b5b60405190808252806020026020018201604052801561170e5781602001602082028036833780820191505090505b5090505f6001606e5461172191906182bd565b905083839050606e5f82825461173791906182bd565b925050819055505f5b848490508110156117f2576117c88686868481811061176257611761618263565b5b905060200281019061177491906182fc565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f81840152601f19601f820116905080830192505050505050505f84866117c391906182bd565b613a52565b8382815181106117db576117da618263565b5b602002602001018181525050806001019050611740565b50506117fc613b34565b9392505050565b61180b6139fd565b61181682825f6140b0565b5050565b3373ffffffffffffffffffffffffffffffffffffffff166118396123c6565b73ffffffffffffffffffffffffffffffffffffffff16148061186b575061186a3360666130e590919063ffffffff16565b5b6118aa576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118a190617f06565b60405180910390fd5b6118b384613d01565b6118bf84848484613d58565b50505050565b60606118cf6139ae565b6118d76139fd565b8282905067ffffffffffffffff8111156118f4576118f3617794565b5b6040519080825280602002602001820160405280156119225781602001602082028036833780820191505090505b5090505f6001606e5461193591906182bd565b905083839050606e5f82825461194b91906182bd565b925050819055505f5b848490508110156119d5576119ab8660405180602001604052805f81525087878581811061198557611984618263565b5b905060200201602081019061199a919061835e565b84866119a691906182bd565b613a52565b8382815181106119be576119bd618263565b5b602002602001018181525050806001019050611954565b50506119df613b34565b9392505050565b611a0083838360405180602001604052805f8152506128eb565b505050565b611a0d6139ae565b611a173382613613565b611a56576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611a4d906183d3565b60405180910390fd5b5f611a6082611d25565b90505f611a6c8361358d565b9050611a7783614156565b611a8282848361433a565b5050611a8c613b34565b50565b5f8060019054906101000a900460ff16159050808015611abe575060015f8054906101000a900460ff1660ff16105b80611aea5750611acd3061444c565b158015611ae9575060015f8054906101000a900460ff1660ff16145b5b611b29576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611b2090618461565b60405180910390fd5b60015f806101000a81548160ff021916908360ff1602179055508015611b645760015f60016101000a81548160ff0219169083151502179055505b611b6e838361446e565b611b766144ca565b8015611bce575f8060016101000a81548160ff0219169083151502179055507f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024986001604051611bc591906184cd565b60405180910390a15b505050565b3373ffffffffffffffffffffffffffffffffffffffff16611bf26123c6565b73ffffffffffffffffffffffffffffffffffffffff161480611c245750611c233360666130e590919063ffffffff16565b5b611c63576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611c5a90617f06565b60405180910390fd5b611c6c81614522565b50565b611c776139fd565b818190508484905014611cbf576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611cb690618530565b60405180910390fd5b5f5b84849050811015611d1e57611d13858583818110611ce257611ce1618263565b5b90506020020135848484818110611cfc57611cfb618263565b5b9050602002810190611d0e91906182fc565b61459c565b806001019050611cc1565b5050505050565b5f80606a5f8481526020019081526020015f205f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603611dca576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611dc190618598565b60405180910390fd5b80915050919050565b611ddb6139fd565b611de58282614638565b5050565b611df1613c05565b611e058160666130e590919063ffffffff16565b611e79573373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f7e1a1a08d52e4ba0e21554733d66165fd5151f99460116223d9e3a608eec5cb160405160405180910390a3611e7781606661468990919063ffffffff16565b505b50565b5f8073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603611eeb576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611ee290618626565b60405180910390fd5b606b5f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b611f38613c05565b611f415f6146b6565b565b5f611f4c6139ae565b3373ffffffffffffffffffffffffffffffffffffffff16611f6b6123c6565b73ffffffffffffffffffffffffffffffffffffffff161480611f9d5750611f9c3360666130e590919063ffffffff16565b5b611fdc576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611fd390617f06565b60405180910390fd5b611ff58260405180602001604052805f8152505f614779565b9050611fff613b34565b919050565b5f61200d6139ae565b3373ffffffffffffffffffffffffffffffffffffffff1661202c6123c6565b73ffffffffffffffffffffffffffffffffffffffff16148061205e575061205d3360666130e590919063ffffffff16565b5b61209d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161209490617f06565b60405180910390fd5b6120eb8484848080601f0160208091040260200160405190810160405280939291908181526020018383808284375f81840152601f19601f820116905080830192505050505050505f614779565b90506120f5613b34565b9392505050565b60606121066139ae565b3373ffffffffffffffffffffffffffffffffffffffff166121256123c6565b73ffffffffffffffffffffffffffffffffffffffff16148061215757506121563360666130e590919063ffffffff16565b5b612196576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161218d90617f06565b60405180910390fd5b8282905067ffffffffffffffff8111156121b3576121b2617794565b5b6040519080825280602002602001820160405280156121e15781602001602082028036833780820191505090505b5090505f6001606e546121f491906182bd565b905083839050606e5f82825461220a91906182bd565b925050819055505f5b848490508110156122c45761229a8686868481811061223557612234618263565b5b905060200281019061224791906182fc565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f81840152601f19601f82011690508083019250505050505050838561229591906182bd565b614779565b8382815181106122ad576122ac618263565b5b602002602001018181525050806001019050612213565b50506122ce613b34565b9392505050565b6122dd6139fd565b6122e88383836140b0565b505050565b60606122f96070613f18565b67ffffffffffffffff81111561231257612311617794565b5b6040519080825280602002602001820160405280156123405781602001602082028036833780820191505090505b5090505f5b61234f6070613f18565b8110156123c25761236a816070613f2b90919063ffffffff16565b82828151811061237d5761237c618263565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050806001019050612345565b5090565b5f60335f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6060606980546123fd90617f51565b80601f016020809104026020016040519081016040528092919081815260200182805461242990617f51565b80156124745780601f1061244b57610100808354040283529160200191612474565b820191905f5260205f20905b81548152906001019060200180831161245757829003601f168201915b5050505050905090565b3373ffffffffffffffffffffffffffffffffffffffff1661249d6123c6565b73ffffffffffffffffffffffffffffffffffffffff1614806124cf57506124ce3360666130e590919063ffffffff16565b5b61250e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161250590617f06565b60405180910390fd5b61251882826147e4565b5050565b612527338383614835565b5050565b3373ffffffffffffffffffffffffffffffffffffffff1661254a6123c6565b73ffffffffffffffffffffffffffffffffffffffff16148061257c575061257b3360666130e590919063ffffffff16565b5b6125bb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016125b290617f06565b60405180910390fd5b818190508484905014612603576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016125fa90618530565b60405180910390fd5b5f5b848490508110156126625761265785858381811061262657612625618263565b5b905060200201358484848181106126405761263f618263565b5b905060200281019061265291906182fc565b61344e565b806001019050612605565b5050505050565b6126716139fd565b61267b338261499c565b50565b60606126886139ae565b3373ffffffffffffffffffffffffffffffffffffffff166126a76123c6565b73ffffffffffffffffffffffffffffffffffffffff1614806126d957506126d83360666130e590919063ffffffff16565b5b612718576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161270f90617f06565b60405180910390fd5b8161ffff1667ffffffffffffffff81111561273657612735617794565b5b6040519080825280602002602001820160405280156127645781602001602082028036833780820191505090505b5090505f6001606e5461277791906182bd565b90508261ffff16606e5f82825461278e91906182bd565b925050819055505f5b8361ffff168110156127f1576127c78560405180602001604052805f81525083856127c291906182bd565b614779565b8382815181106127da576127d9618263565b5b602002602001018181525050806001019050612797565b50506127fb613b34565b92915050565b3373ffffffffffffffffffffffffffffffffffffffff166128206123c6565b73ffffffffffffffffffffffffffffffffffffffff16148061285257506128513360666130e590919063ffffffff16565b5b612891576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161288890617f06565b60405180910390fd5b61289e8585858585613f42565b5050505050565b5f6010606a5f8481526020019081526020015f205f0160149054906101000a90046bffffffffffffffffffffffff166bffffffffffffffffffffffff16901c9050919050565b6128f53383613613565b612934576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161292b90618245565b60405180910390fd5b61294084848484614a72565b50505050565b6060612951826133ce565b612990576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612987906180e7565b60405180910390fd5b61299982614ace565b9050919050565b6060806129ac836133ce565b6129eb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016129e2906180e7565b60405180910390fd5b6129f483614ae3565b91509150915091565b6060612a08826133ce565b612a47576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612a3e906180e7565b60405180910390fd5b612a5082615043565b9050919050565b3373ffffffffffffffffffffffffffffffffffffffff16612a766123c6565b73ffffffffffffffffffffffffffffffffffffffff161480612aa85750612aa73360666130e590919063ffffffff16565b5b612ae7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612ade90617f06565b60405180910390fd5b612af0816154bc565b50565b5f612afc6139ae565b612b046139fd565b612b1e8360405180602001604052805f815250845f613a52565b9050612b28613b34565b92915050565b606080612b3a836133ce565b612b79576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612b70906180e7565b60405180910390fd5b612b8283614ae3565b91509150915091565b6060612b956139ae565b612b9d6139fd565b8161ffff1667ffffffffffffffff811115612bbb57612bba617794565b5b604051908082528060200260200182016040528015612be95781602001602082028036833780820191505090505b5090505f6001606e54612bfc91906182bd565b90508261ffff16606e5f828254612c1391906182bd565b925050819055505f5b8361ffff16811015612c7757612c4d8560405180602001604052805f8152505f8486612c4891906182bd565b613a52565b838281518110612c6057612c5f618263565b5b602002602001018181525050806001019050612c1c565b5050612c81613b34565b92915050565b612c8f6139fd565b612c9a83838361459c565b505050565b5f606d5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16905092915050565b3373ffffffffffffffffffffffffffffffffffffffff16612d4c6123c6565b73ffffffffffffffffffffffffffffffffffffffff161480612d7e5750612d7d3360666130e590919063ffffffff16565b5b612dbd576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612db490617f06565b60405180910390fd5b612dc7828261552e565b5050565b612dd3613c05565b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603612e41576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612e38906186b4565b60405180910390fd5b612e4a816146b6565b50565b5f612e566139ae565b612e5e6139fd565b612ead8484848080601f0160208091040260200160405190810160405280939291908181526020018383808284375f81840152601f19601f820116905080830192505050505050505f80613a52565b9050612eb7613b34565b9392505050565b600381565b5f7fb5d2729f000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19161480612f745750639088c20760e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b80612f845750612f83826157a0565b5b9050919050565b5f7f80ac58cd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061305557507f5b5e139f000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b8061306557506130648261306c565b5b9050919050565b5f7f553e757e000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614806130de57506130dd826159a4565b5b9050919050565b5f61310a835f018373ffffffffffffffffffffffffffffffffffffffff165f1b615a0d565b905092915050565b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415801561317a57503073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614155b6131b9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016131b09061871c565b60405180910390fd5b6131cd8160706130e590919063ffffffff16565b15613242573373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167fd19cf84cf0fec6bec9ddfa29c63adf83a55707c712f32c8285d6180a7890147960405160405180910390a3613240816070613c8390919063ffffffff16565b505b6132568160726130e590919063ffffffff16565b6132ca573373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f05ac7bc5a606cd92a63365f9fda244499b9add0526b22d99937b6bd88181059c60405160405180910390a36132c881607261468990919063ffffffff16565b505b50565b6132d6816133ce565b613315576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161330c90618598565b60405180910390fd5b50565b81606c5f8381526020019081526020015f205f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff1661338883611d25565b73ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45050565b5f8073ffffffffffffffffffffffffffffffffffffffff16606a5f8481526020019081526020015f205f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614159050919050565b606061344382614ae3565b905080915050919050565b5f8311801561345f5750606e548311155b801561349e57505f73ffffffffffffffffffffffffffffffffffffffff166134868461358d565b73ffffffffffffffffffffffffffffffffffffffff16145b6134dd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016134d490618784565b60405180910390fd5b818160775f8681526020019081526020015f2091826134fd929190618940565b50505050565b61350f84848484615a2d565b60795f8681526020019081526020015f205f61352b9190616c84565b6135488484848460795f8b81526020019081526020015f20615b01565b847fabb46fe0761d77584bde75697647804ffd8113abd4d8d06bc664150395eccdee8585858560405161357e9493929190618b25565b60405180910390a25050505050565b5f80606a5f8481526020019081526020015f205f0160149054906101000a90046bffffffffffffffffffffffff1690505f8161ffff16036135d1575f91505061360e565b607e5f8261ffff1661ffff1681526020019081526020015f205f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169150505b919050565b5f8061361e83611d25565b90508073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff161480613660575061365f8185612c9f565b5b8061369e57508373ffffffffffffffffffffffffffffffffffffffff1661368684610d99565b73ffffffffffffffffffffffffffffffffffffffff16145b91505092915050565b5f606a5f8381526020019081526020015f206040518060400160405290815f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020015f820160149054906101000a90046bffffffffffffffffffffffff166bffffffffffffffffffffffff166bffffffffffffffffffffffff168152505090505f815f015190508473ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16146137cc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016137c390618bce565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff160361383a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161383190618c5c565b60405180910390fd5b5f8260200151905061384e86868684615c1b565b6138585f85613318565b6001606b5f8873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825403925050819055506001606b5f8773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f828254019250508190555084606a5f8681526020019081526020015f205f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550838573ffffffffffffffffffffffffffffffffffffffff168773ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a46139a686868684615c2d565b505050505050565b6002606554036139f3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016139ea90618cc4565b60405180910390fd5b6002606581905550565b613a113360706130e590919063ffffffff16565b613a50576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613a4790618d2c565b60405180910390fd5b565b5f808203613a7557606e5f8154613a6890618d4a565b91905081905550606e5491505b613a7f8583615c33565b613a898583615d8d565b613b008583607d5f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900461ffff1661ffff1660108769ffffffffffffffffffff16901b1769ffffffffffffffffffff16615d91565b5f84511115613b29578360775f8481526020019081526020015f209081613b279190618d91565b505b819050949350505050565b6001606581905550565b5f805f80613b4b86614ae3565b91509150600182511115613b94576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613b8b90618eaa565b60405180910390fd5b5f825103613ba957305f935093505050613bfe565b815f81518110613bbc57613bbb618263565b5b602002602001015161271086835f81518110613bdb57613bda618263565b5b6020026020010151613bed9190618ec8565b613bf79190618f36565b9350935050505b9250929050565b613c0d615db0565b73ffffffffffffffffffffffffffffffffffffffff16613c2b6123c6565b73ffffffffffffffffffffffffffffffffffffffff1614613c81576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613c7890618fb0565b60405180910390fd5b565b5f613ca8835f018373ffffffffffffffffffffffffffffffffffffffff165f1b615db7565b905092915050565b818160745f8073ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f209182613cfc929190618940565b505050565b613d158160726130e590919063ffffffff16565b15613d55576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613d4c906181b7565b60405180910390fd5b50565b61ffff607c5f9054906101000a900461ffff1661ffff1610613daf576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613da690619018565b60405180910390fd5b5f607d5f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900461ffff1661ffff1603613f0657607c5f81819054906101000a900461ffff16613e1f90619036565b91906101000a81548161ffff021916908361ffff160217905550607c5f9054906101000a900461ffff16607d5f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548161ffff021916908361ffff16021790555083607e5f607c5f9054906101000a900461ffff1661ffff1661ffff1681526020019081526020015f205f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b613f1284848484615eb3565b50505050565b5f613f24825f0161606a565b9050919050565b5f613f38835f0183616079565b5f1c905092915050565b613f4e84848484615a2d565b60785f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f613f969190616c84565b613fdf8484848460785f8b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20615b01565b5f73ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff1603614054577f2b6849d5976d799a5b0ca4dfd6b40a3d7afe9ea72c091fa01a958594f9a2659b848484846040516140479493929190618b25565b60405180910390a16140a9565b8473ffffffffffffffffffffffffffffffffffffffff167f535a93d2cb000582c0ebeaa9be4890ec6a287f98eb2df00c54c300612fd78d8f858585856040516140a09493929190618b25565b60405180910390a25b5050505050565b828260745f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2091826140fc929190618940565b508060755f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff021916908315150217905550505050565b5f606a5f8381526020019081526020015f206040518060400160405290815f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020015f820160149054906101000a90046bffffffffffffffffffffffff166bffffffffffffffffffffffff166bffffffffffffffffffffffff168152505090505f815f015190505f82602001519050614221825f8684615c1b565b61422b5f85613318565b6001606b5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8282540392505081905550606a5f8581526020019081526020015f205f8082015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a8154906bffffffffffffffffffffffff02191690555050835f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a4614334825f8684615c2d565b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461440657614397817f45a1b92c000000000000000000000000000000000000000000000000000000006160a0565b15614405578073ffffffffffffffffffffffffffffffffffffffff166345a1b92c84846040518363ffffffff1660e01b81526004016143d792919061736d565b5f604051808303815f87803b1580156143ee575f80fd5b505af1158015614400573d5f803e3d5ffd5b505050505b5b5f60775f8481526020019081526020015f20805461442390617f51565b9050146144475760775f8381526020019081526020015f205f6144469190616ca2565b5b505050565b5f808273ffffffffffffffffffffffffffffffffffffffff163b119050919050565b5f60019054906101000a900460ff166144bc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016144b3906190cf565b60405180910390fd5b6144c682826160c4565b5050565b5f60019054906101000a900460ff16614518576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161450f906190cf565b60405180910390fd5b614520616136565b565b80606f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507f959c0e47a2fe3cf01e237ba4892e2cc3194d77cbfb33e434e40873225d6b595f816040516145919190616f90565b60405180910390a150565b3373ffffffffffffffffffffffffffffffffffffffff166145bc8461358d565b73ffffffffffffffffffffffffffffffffffffffff1614614612576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161460990618784565b60405180910390fd5b818160775f8681526020019081526020015f209182614632929190618940565b50505050565b818160765f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f209182614684929190618940565b505050565b5f6146ae835f018373ffffffffffffffffffffffffffffffffffffffff165f1b616196565b905092915050565b5f60335f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508160335f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b5f80820361479c57606e5f815461478f90618d4a565b91905081905550606e5491505b6147a684836161fd565b6147b184835f615d91565b5f835111156147da578260775f8481526020019081526020015f2090816147d89190618d91565b505b8190509392505050565b818160765f8073ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f209182614830929190618940565b505050565b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036148a3576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161489a90619137565b60405180910390fd5b80606d5f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c318360405161498f9190616df5565b60405180910390a3505050565b6149c6827f45ffcdad000000000000000000000000000000000000000000000000000000006160a0565b15614a6e5780607a5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f072a7592283e2c2d1d56d21517ff6013325e0f55483f4828373ff4d98b0a1a3682604051614a659190616df5565b60405180910390a25b5050565b614a7d8484846136a7565b614a8984848484616201565b614ac8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401614abf906191c5565b60405180910390fd5b50505050565b6060614ad982614ae3565b5080915050919050565b6060805f60795f8581526020019081526020015f20805480602002602001604051908101604052809291908181526020015f905b82821015614bb6578382905f5260205f20016040518060400160405290815f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020015f820160149054906101000a900461ffff1661ffff1661ffff168152505081526020019060010190614b17565b5050505090505f815103614dcc575f614bce8561358d565b90505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614614dca57614c2d817f9ca7dc7a000000000000000000000000000000000000000000000000000000006160a0565b15614cc8578073ffffffffffffffffffffffffffffffffffffffff16639ca7dc7a30876040518363ffffffff1660e01b8152600401614c6d92919061736d565b5f60405180830381865afa158015614c87573d5f803e3d5ffd5b505050506040513d5f823e3d601f19601f82011682018060405250810190614caf919061938b565b80945081955050505f84511115614cc757505061503e565b5b60785f8273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20805480602002602001604051908101604052809291908181526020015f905b82821015614dc3578382905f5260205f20016040518060400160405290815f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020015f820160149054906101000a900461ffff1661ffff1661ffff168152505081526020019060010190614d24565b5050505091505b505b5f815103614ed65760785f8073ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20805480602002602001604051908101604052809291908181526020015f905b82821015614ecf578382905f5260205f20016040518060400160405290815f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020015f820160149054906101000a900461ffff1661ffff1661ffff168152505081526020019060010190614e30565b5050505090505b5f8151111561503c57805167ffffffffffffffff811115614efa57614ef9617794565b5b604051908082528060200260200182016040528015614f285781602001602082028036833780820191505090505b509250805167ffffffffffffffff811115614f4657614f45617794565b5b604051908082528060200260200182016040528015614f745781602001602082028036833780820191505090505b5091505f5b815181101561503a57818181518110614f9557614f94618263565b5b60200260200101515f0151848281518110614fb357614fb2618263565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505081818151811061500057614fff618263565b5b60200260200101516020015161ffff1683828151811061502357615022618263565b5b602002602001018181525050806001019050614f79565b505b505b915091565b60605f821180156150565750606e548211155b615095576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161508c90618784565b60405180910390fd5b5f61509f8361358d565b90506150b58160726130e590919063ffffffff16565b156150f5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016150ec906181b7565b60405180910390fd5b5f60775f8581526020019081526020015f20805461511290617f51565b90501461527f575f60765f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20805461516290617f51565b9050146151df5760765f8273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2060775f8581526020019081526020015f206040516020016151c892919061948b565b6040516020818303038152906040529150506154b7565b60775f8481526020019081526020015f2080546151fb90617f51565b80601f016020809104026020016040519081016040528092919081815260200182805461522790617f51565b80156152725780601f1061524957610100808354040283529160200191615272565b820191905f5260205f20905b81548152906001019060200180831161525557829003601f168201915b50505050509150506154b7565b6152a9817fe9dc6375000000000000000000000000000000000000000000000000000000006160a0565b15615333578073ffffffffffffffffffffffffffffffffffffffff1663e9dc637530856040518363ffffffff1660e01b81526004016152e992919061736d565b5f60405180830381865afa158015615303573d5f803e3d5ffd5b505050506040513d5f823e3d601f19601f8201168201806040525081019061532b919061951c565b9150506154b7565b60755f8273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff166153ef5760745f8273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f206153c78461637c565b6040516020016153d8929190619593565b6040516020818303038152906040529150506154b7565b60745f8273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20805461543790617f51565b80601f016020809104026020016040519081016040528092919081815260200182805461546390617f51565b80156154ae5780601f10615485576101008083540402835291602001916154ae565b820191905f5260205f20905b81548152906001019060200180831161549157829003601f168201915b50505050509150505b919050565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167fd19cf84cf0fec6bec9ddfa29c63adf83a55707c712f32c8285d6180a7890147960405160405180910390a361552a816070613c8390919063ffffffff16565b5050565b6155428260706130e590919063ffffffff16565b615581576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161557890619600565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614806155e157506155e0817ff029c2d8000000000000000000000000000000000000000000000000000000006160a0565b5b615620576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161561790619668565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff16607b5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161461579c5780607b5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f6a835c4fcf7e0d398db3762332fdaa1471814ad39f1e2d6d0b3fdabf8efee3e060405160405180910390a45b5050565b5f7f5365e65c000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061585157506328f10a2160e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b80615861575061586082612f8b565b5b806158b0575063bb3bafd660e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b806158ff575063b779958460e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b8061594e575063d5a06d4c60e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b8061599d5750632a55205a60e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b9050919050565b5f7f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b5f80836001015f8481526020019081526020015f20541415905092915050565b818190508484905014615a75576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401615a6c90618530565b60405180910390fd5b5f805b83839050811015615ab557838382818110615a9657615a95618263565b5b9050602002013582615aa891906182bd565b9150806001019050615a78565b506127108110615afa576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401615af1906196d0565b60405180910390fd5b5050505050565b5f5b83839050811015615c1357816040518060400160405280888885818110615b2d57615b2c618263565b5b9050602002016020810190615b4291906196ee565b73ffffffffffffffffffffffffffffffffffffffff168152602001868685818110615b7057615b6f618263565b5b9050602002013561ffff16815250908060018154018082558091505060019003905f5260205f20015f909190919091505f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151815f0160146101000a81548161ffff021916908361ffff1602179055505050806001019050615b03565b505050505050565b615c2784848484616446565b50505050565b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff16607b5f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614615d8957607b5f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663f029c2d83384846040518463ffffffff1660e01b8152600401615d5b93929190619719565b5f604051808303815f87803b158015615d72575f80fd5b505af1158015615d84573d5f803e3d5ffd5b505050505b5050565b5050565b615dab83838360405180602001604052805f8152506164c5565b505050565b5f33905090565b5f80836001015f8481526020019081526020015f205490505f8114615ea8575f600182615de4919061974e565b90505f6001865f0180549050615dfa919061974e565b9050818114615e60575f865f018281548110615e1957615e18618263565b5b905f5260205f200154905080875f018481548110615e3a57615e39618263565b5b905f5260205f20018190555083876001015f8381526020019081526020015f2081905550505b855f01805480615e7357615e72619781565b5b600190038181905f5260205f20015f90559055856001015f8681526020019081526020015f205f905560019350505050615ead565b5f9150505b92915050565b3073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1614158015615f0a5750615f098473ffffffffffffffffffffffffffffffffffffffff1661444c565b5b615f49576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401615f40906197f8565b60405180910390fd5b3373ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fd8cb8ba4086944eabf43c5535b7712015e4d4c714b24bf812c040ea5b7a3e42a60405160405180910390a3828260745f8773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f209182615fef929190618940565b508060755f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff02191690831515021790555061605884607061468990919063ffffffff16565b5061606484600161499c565b50505050565b5f815f01805490509050919050565b5f825f01828154811061608f5761608e618263565b5b905f5260205f200154905092915050565b5f6160aa83616752565b80156160bc57506160bb838361679e565b5b905092915050565b5f60019054906101000a900460ff16616112576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401616109906190cf565b60405180910390fd5b81606890816161219190618d91565b5080606990816161319190618d91565b505050565b5f60019054906101000a900460ff16616184576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161617b906190cf565b60405180910390fd5b61619461618f615db0565b6146b6565b565b5f6161a18383615a0d565b6161f357825f0182908060018154018082558091505060019003905f5260205f20015f9091909190915055825f0180549050836001015f8481526020019081526020015f2081905550600190506161f7565b5f90505b92915050565b5050565b5f6162218473ffffffffffffffffffffffffffffffffffffffff16616857565b1561636f578373ffffffffffffffffffffffffffffffffffffffff1663150b7a02338786866040518563ffffffff1660e01b81526004016162659493929190619868565b6020604051808303815f875af19250505080156162a057506040513d601f19601f8201168201806040525081019061629d91906198c6565b60015b61631f573d805f81146162ce576040519150601f19603f3d011682016040523d82523d5f602084013e6162d3565b606091505b505f815103616317576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161630e906191c5565b60405180910390fd5b805181602001fd5b63150b7a0260e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614915050616374565b600190505b949350505050565b60605f600161638a84616879565b0190505f8167ffffffffffffffff8111156163a8576163a7617794565b5b6040519080825280601f01601f1916602001820160405280156163da5781602001600182028036833780820191505090505b5090505f82602001820190505b60011561643b578080600190039150507f3031323334353637383961626364656600000000000000000000000000000000600a86061a8153600a85816164305761642f618f09565b5b0494505f85036163e7575b819350505050919050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603156164bf576164be848484607e5f8661ffff1661ffff1681526020019081526020015f205f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166169ca565b5b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603616533576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161652a9061993b565b60405180910390fd5b61653c836133ce565b1561657c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401616573906199a3565b60405180910390fd5b6165885f858585615c1b565b6001606b5f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f828254019250508190555060405180604001604052808573ffffffffffffffffffffffffffffffffffffffff168152602001836bffffffffffffffffffffffff16815250606a5f8581526020019081526020015f205f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151815f0160146101000a8154816bffffffffffffffffffffffff02191690836bffffffffffffffffffffffff160217905550905050828473ffffffffffffffffffffffffffffffffffffffff165f73ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a46167015f858585615c2d565b61670d5f858584616201565b61674c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401616743906191c5565b60405180910390fd5b50505050565b5f61677d827f01ffc9a70000000000000000000000000000000000000000000000000000000061679e565b801561679757506167958263ffffffff60e01b61679e565b155b9050919050565b5f806301ffc9a760e01b836040516024016167b991906199d0565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505090505f805f60205f8551602087018a617530fa92503d91505f519050828015616840575060208210155b801561684b57505f81115b94505050505092915050565b5f808273ffffffffffffffffffffffffffffffffffffffff163b119050919050565b5f805f90507a184f03e93ff9f4daa797ed6e38ed64bf6a1f01000000000000000083106168d5577a184f03e93ff9f4daa797ed6e38ed64bf6a1f01000000000000000083816168cb576168ca618f09565b5b0492506040810190505b6d04ee2d6d415b85acef81000000008310616912576d04ee2d6d415b85acef8100000000838161690857616907618f09565b5b0492506020810190505b662386f26fc10000831061694157662386f26fc10000838161693757616936618f09565b5b0492506010810190505b6305f5e100831061696a576305f5e10083816169605761695f618f09565b5b0492506008810190505b612710831061698f57612710838161698557616984618f09565b5b0492506004810190505b606483106169b257606483816169a8576169a7618f09565b5b0492506002810190505b600a83106169c1576001810190505b80915050919050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff160315616c7e575f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614158015616a805750607a5f8273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff165b15616b48578073ffffffffffffffffffffffffffffffffffffffff16635e6a6f8a338686866040518563ffffffff1660e01b8152600401616ac494939291906199e9565b6020604051808303815f875af1158015616ae0573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190616b049190619a40565b616b43576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401616b3a90619ab5565b60405180910390fd5b616c7d565b5f73ffffffffffffffffffffffffffffffffffffffff16606f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614616c7c57606f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16635e6a6f8a338686866040518563ffffffff1660e01b8152600401616bfc94939291906199e9565b6020604051808303815f875af1158015616c18573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190616c3c9190619a40565b616c7b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401616c7290619ab5565b60405180910390fd5b5b5b5b50505050565b5080545f8255905f5260205f2090810190616c9f9190616cdf565b50565b508054616cae90617f51565b5f825580601f10616cbf5750616cdc565b601f0160209004905f5260205f2090810190616cdb9190616d2f565b5b50565b5b80821115616d2b575f8082015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549061ffff021916905550600101616ce0565b5090565b5b80821115616d46575f815f905550600101616d30565b5090565b5f604051905090565b5f80fd5b5f80fd5b5f7fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b616d8f81616d5b565b8114616d99575f80fd5b50565b5f81359050616daa81616d86565b92915050565b5f60208284031215616dc557616dc4616d53565b5b5f616dd284828501616d9c565b91505092915050565b5f8115159050919050565b616def81616ddb565b82525050565b5f602082019050616e085f830184616de6565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f616e3782616e0e565b9050919050565b616e4781616e2d565b8114616e51575f80fd5b50565b5f81359050616e6281616e3e565b92915050565b5f60208284031215616e7d57616e7c616d53565b5b5f616e8a84828501616e54565b91505092915050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f616ed582616e93565b616edf8185616e9d565b9350616eef818560208601616ead565b616ef881616ebb565b840191505092915050565b5f6020820190508181035f830152616f1b8184616ecb565b905092915050565b5f819050919050565b616f3581616f23565b8114616f3f575f80fd5b50565b5f81359050616f5081616f2c565b92915050565b5f60208284031215616f6b57616f6a616d53565b5b5f616f7884828501616f42565b91505092915050565b616f8a81616e2d565b82525050565b5f602082019050616fa35f830184616f81565b92915050565b5f8060408385031215616fbf57616fbe616d53565b5b5f616fcc85828601616e54565b9250506020616fdd85828601616f42565b9150509250929050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b61701981616f23565b82525050565b5f61702a8383617010565b60208301905092915050565b5f602082019050919050565b5f61704c82616fe7565b6170568185616ff1565b935061706183617001565b805f5b83811015617091578151617078888261701f565b975061708383617036565b925050600181019050617064565b5085935050505092915050565b5f6020820190508181035f8301526170b68184617042565b905092915050565b5f80fd5b5f80fd5b5f80fd5b5f8083601f8401126170df576170de6170be565b5b8235905067ffffffffffffffff8111156170fc576170fb6170c2565b5b602083019150836001820283011115617118576171176170c6565b5b9250929050565b5f805f6040848603121561713657617135616d53565b5b5f61714386828701616f42565b935050602084013567ffffffffffffffff81111561716457617163616d57565b5b617170868287016170ca565b92509250509250925092565b5f8083601f840112617191576171906170be565b5b8235905067ffffffffffffffff8111156171ae576171ad6170c2565b5b6020830191508360208202830111156171ca576171c96170c6565b5b9250929050565b5f8083601f8401126171e6576171e56170be565b5b8235905067ffffffffffffffff811115617203576172026170c2565b5b60208301915083602082028301111561721f5761721e6170c6565b5b9250929050565b5f805f805f6060868803121561723f5761723e616d53565b5b5f61724c88828901616f42565b955050602086013567ffffffffffffffff81111561726d5761726c616d57565b5b6172798882890161717c565b9450945050604086013567ffffffffffffffff81111561729c5761729b616d57565b5b6172a8888289016171d1565b92509250509295509295909350565b5f805f606084860312156172ce576172cd616d53565b5b5f6172db86828701616e54565b93505060206172ec86828701616e54565b92505060406172fd86828701616f42565b9150509250925092565b61731081616f23565b82525050565b5f6020820190506173295f830184617307565b92915050565b5f806040838503121561734557617344616d53565b5b5f61735285828601616f42565b925050602061736385828601616f42565b9150509250929050565b5f6040820190506173805f830185616f81565b61738d6020830184617307565b9392505050565b5f80602083850312156173aa576173a9616d53565b5b5f83013567ffffffffffffffff8111156173c7576173c6616d57565b5b6173d3858286016170ca565b92509250509250929050565b5f805f604084860312156173f6576173f5616d53565b5b5f61740386828701616e54565b935050602084013567ffffffffffffffff81111561742457617423616d57565b5b617430868287016170ca565b92509250509250925092565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b61746e81616e2d565b82525050565b5f61747f8383617465565b60208301905092915050565b5f602082019050919050565b5f6174a18261743c565b6174ab8185617446565b93506174b683617456565b805f5b838110156174e65781516174cd8882617474565b97506174d88361748b565b9250506001810190506174b9565b5085935050505092915050565b5f6020820190508181035f83015261750b8184617497565b905092915050565b5f805f806040858703121561752b5761752a616d53565b5b5f85013567ffffffffffffffff81111561754857617547616d57565b5b6175548782880161717c565b9450945050602085013567ffffffffffffffff81111561757757617576616d57565b5b617583878288016171d1565b925092505092959194509250565b5f8083601f8401126175a6576175a56170be565b5b8235905067ffffffffffffffff8111156175c3576175c26170c2565b5b6020830191508360208202830111156175df576175de6170c6565b5b9250929050565b5f805f604084860312156175fd576175fc616d53565b5b5f61760a86828701616e54565b935050602084013567ffffffffffffffff81111561762b5761762a616d57565b5b61763786828701617591565b92509250509250925092565b61764c81616ddb565b8114617656575f80fd5b50565b5f8135905061766781617643565b92915050565b5f805f806060858703121561768557617684616d53565b5b5f61769287828801616e54565b945050602085013567ffffffffffffffff8111156176b3576176b2616d57565b5b6176bf878288016170ca565b935093505060406176d287828801617659565b91505092959194509250565b5f8083601f8401126176f3576176f26170be565b5b8235905067ffffffffffffffff8111156177105761770f6170c2565b5b60208301915083602082028301111561772c5761772b6170c6565b5b9250929050565b5f805f6040848603121561774a57617749616d53565b5b5f61775786828701616e54565b935050602084013567ffffffffffffffff81111561777857617777616d57565b5b617784868287016176de565b92509250509250925092565b5f80fd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b6177ca82616ebb565b810181811067ffffffffffffffff821117156177e9576177e8617794565b5b80604052505050565b5f6177fb616d4a565b905061780782826177c1565b919050565b5f67ffffffffffffffff82111561782657617825617794565b5b61782f82616ebb565b9050602081019050919050565b828183375f83830152505050565b5f61785c6178578461780c565b6177f2565b90508281526020810184848401111561787857617877617790565b5b61788384828561783c565b509392505050565b5f82601f83011261789f5761789e6170be565b5b81356178af84826020860161784a565b91505092915050565b5f80604083850312156178ce576178cd616d53565b5b5f83013567ffffffffffffffff8111156178eb576178ea616d57565b5b6178f78582860161788b565b925050602083013567ffffffffffffffff81111561791857617917616d57565b5b6179248582860161788b565b9150509250929050565b5f805f806040858703121561794657617945616d53565b5b5f85013567ffffffffffffffff81111561796357617962616d57565b5b61796f878288016171d1565b9450945050602085013567ffffffffffffffff81111561799257617991616d57565b5b61799e87828801617591565b925092505092959194509250565b5f805f604084860312156179c3576179c2616d53565b5b5f84013567ffffffffffffffff8111156179e0576179df616d57565b5b6179ec868287016170ca565b935093505060206179ff86828701617659565b9150509250925092565b5f8060408385031215617a1f57617a1e616d53565b5b5f617a2c85828601616e54565b9250506020617a3d85828601617659565b9150509250929050565b5f60208284031215617a5c57617a5b616d53565b5b5f617a6984828501617659565b91505092915050565b5f61ffff82169050919050565b617a8881617a72565b8114617a92575f80fd5b50565b5f81359050617aa381617a7f565b92915050565b5f8060408385031215617abf57617abe616d53565b5b5f617acc85828601616e54565b9250506020617add85828601617a95565b9150509250929050565b5f805f805f60608688031215617b0057617aff616d53565b5b5f617b0d88828901616e54565b955050602086013567ffffffffffffffff811115617b2e57617b2d616d57565b5b617b3a8882890161717c565b9450945050604086013567ffffffffffffffff811115617b5d57617b5c616d57565b5b617b69888289016171d1565b92509250509295509295909350565b5f69ffffffffffffffffffff82169050919050565b617b9681617b78565b82525050565b5f602082019050617baf5f830184617b8d565b92915050565b5f67ffffffffffffffff821115617bcf57617bce617794565b5b617bd882616ebb565b9050602081019050919050565b5f617bf7617bf284617bb5565b6177f2565b905082815260208101848484011115617c1357617c12617790565b5b617c1e84828561783c565b509392505050565b5f82601f830112617c3a57617c396170be565b5b8135617c4a848260208601617be5565b91505092915050565b5f805f8060808587031215617c6b57617c6a616d53565b5b5f617c7887828801616e54565b9450506020617c8987828801616e54565b9350506040617c9a87828801616f42565b925050606085013567ffffffffffffffff811115617cbb57617cba616d57565b5b617cc787828801617c26565b91505092959194509250565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b5f617d0682616e0e565b9050919050565b617d1681617cfc565b82525050565b5f617d278383617d0d565b60208301905092915050565b5f602082019050919050565b5f617d4982617cd3565b617d538185617cdd565b9350617d5e83617ced565b805f5b83811015617d8e578151617d758882617d1c565b9750617d8083617d33565b925050600181019050617d61565b5085935050505092915050565b5f6020820190508181035f830152617db38184617d3f565b905092915050565b5f6040820190508181035f830152617dd38185617d3f565b90508181036020830152617de78184617042565b90509392505050565b617df981617b78565b8114617e03575f80fd5b50565b5f81359050617e1481617df0565b92915050565b5f8060408385031215617e3057617e2f616d53565b5b5f617e3d85828601616e54565b9250506020617e4e85828601617e06565b9150509250929050565b5f8060408385031215617e6e57617e6d616d53565b5b5f617e7b85828601616e54565b9250506020617e8c85828601616e54565b9150509250929050565b7f41646d696e436f6e74726f6c3a204d757374206265206f776e6572206f7220615f8201527f646d696e00000000000000000000000000000000000000000000000000000000602082015250565b5f617ef0602483616e9d565b9150617efb82617e96565b604082019050919050565b5f6020820190508181035f830152617f1d81617ee4565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680617f6857607f821691505b602082108103617f7b57617f7a617f24565b5b50919050565b7f4552433732313a20617070726f76616c20746f2063757272656e74206f776e655f8201527f7200000000000000000000000000000000000000000000000000000000000000602082015250565b5f617fdb602183616e9d565b9150617fe682617f81565b604082019050919050565b5f6020820190508181035f83015261800881617fcf565b9050919050565b7f4552433732313a20617070726f76652063616c6c6572206973206e6f7420746f5f8201527f6b656e206f776e6572206f7220617070726f76656420666f7220616c6c000000602082015250565b5f618069603d83616e9d565b91506180748261800f565b604082019050919050565b5f6020820190508181035f8301526180968161805d565b9050919050565b7f4e6f6e6578697374656e7420746f6b656e0000000000000000000000000000005f82015250565b5f6180d1601183616e9d565b91506180dc8261809d565b602082019050919050565b5f6020820190508181035f8301526180fe816180c5565b9050919050565b7f4e6f20657874656e73696f6e20666f7220746f6b656e000000000000000000005f82015250565b5f618139601683616e9d565b915061814482618105565b602082019050919050565b5f6020820190508181035f8301526181668161812d565b9050919050565b7f457874656e73696f6e20626c61636b6c697374656400000000000000000000005f82015250565b5f6181a1601583616e9d565b91506181ac8261816d565b602082019050919050565b5f6020820190508181035f8301526181ce81618195565b9050919050565b7f4552433732313a2063616c6c6572206973206e6f7420746f6b656e206f776e655f8201527f72206f7220617070726f76656400000000000000000000000000000000000000602082015250565b5f61822f602d83616e9d565b915061823a826181d5565b604082019050919050565b5f6020820190508181035f83015261825c81618223565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6182c782616f23565b91506182d283616f23565b92508282019050808211156182ea576182e9618290565b5b92915050565b5f80fd5b5f80fd5b5f80fd5b5f8083356001602003843603038112618318576183176182f0565b5b80840192508235915067ffffffffffffffff82111561833a576183396182f4565b5b602083019250600182023603831315618356576183556182f8565b5b509250929050565b5f6020828403121561837357618372616d53565b5b5f61838084828501617e06565b91505092915050565b7f43616c6c6572206973206e6f74206f776e6572206f7220617070726f766564005f82015250565b5f6183bd601f83616e9d565b91506183c882618389565b602082019050919050565b5f6020820190508181035f8301526183ea816183b1565b9050919050565b7f496e697469616c697a61626c653a20636f6e747261637420697320616c7265615f8201527f647920696e697469616c697a6564000000000000000000000000000000000000602082015250565b5f61844b602e83616e9d565b9150618456826183f1565b604082019050919050565b5f6020820190508181035f8301526184788161843f565b9050919050565b5f819050919050565b5f60ff82169050919050565b5f819050919050565b5f6184b76184b26184ad8461847f565b618494565b618488565b9050919050565b6184c78161849d565b82525050565b5f6020820190506184e05f8301846184be565b92915050565b7f496e76616c696420696e707574000000000000000000000000000000000000005f82015250565b5f61851a600d83616e9d565b9150618525826184e6565b602082019050919050565b5f6020820190508181035f8301526185478161850e565b9050919050565b7f4552433732313a20696e76616c696420746f6b656e20494400000000000000005f82015250565b5f618582601883616e9d565b915061858d8261854e565b602082019050919050565b5f6020820190508181035f8301526185af81618576565b9050919050565b7f4552433732313a2061646472657373207a65726f206973206e6f7420612076615f8201527f6c6964206f776e65720000000000000000000000000000000000000000000000602082015250565b5f618610602983616e9d565b915061861b826185b6565b604082019050919050565b5f6020820190508181035f83015261863d81618604565b9050919050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f20615f8201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b5f61869e602683616e9d565b91506186a982618644565b604082019050919050565b5f6020820190508181035f8301526186cb81618692565b9050919050565b7f43616e6e6f7420626c61636b6c69737420796f757273656c66000000000000005f82015250565b5f618706601983616e9d565b9150618711826186d2565b602082019050919050565b5f6020820190508181035f830152618733816186fa565b9050919050565b7f496e76616c696420746f6b656e000000000000000000000000000000000000005f82015250565b5f61876e600d83616e9d565b91506187798261873a565b602082019050919050565b5f6020820190508181035f83015261879b81618762565b9050919050565b5f82905092915050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026188087fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826187cd565b61881286836187cd565b95508019841693508086168417925050509392505050565b5f61884461883f61883a84616f23565b618494565b616f23565b9050919050565b5f819050919050565b61885d8361882a565b6188716188698261884b565b8484546187d9565b825550505050565b5f90565b618885618879565b618890818484618854565b505050565b5b818110156188b3576188a85f8261887d565b600181019050618896565b5050565b601f8211156188f8576188c9816187ac565b6188d2846187be565b810160208510156188e1578190505b6188f56188ed856187be565b830182618895565b50505b505050565b5f82821c905092915050565b5f6189185f19846008026188fd565b1980831691505092915050565b5f6189308383618909565b9150826002028217905092915050565b61894a83836187a2565b67ffffffffffffffff81111561896357618962617794565b5b61896d8254617f51565b6189788282856188b7565b5f601f8311600181146189a5575f8415618993578287013590505b61899d8582618925565b865550618a04565b601f1984166189b3866187ac565b5f5b828110156189da578489013582556001820191506020850194506020810190506189b5565b868310156189f757848901356189f3601f891682618909565b8355505b6001600288020188555050505b50505050505050565b5f819050919050565b618a1f81617cfc565b8114618a29575f80fd5b50565b5f81359050618a3a81618a16565b92915050565b5f618a4e6020840184618a2c565b905092915050565b5f602082019050919050565b5f618a6d8385617cdd565b9350618a7882618a0d565b805f5b85811015618ab057618a8d8284618a40565b618a978882617d1c565b9750618aa283618a56565b925050600181019050618a7b565b5085925050509392505050565b5f80fd5b82818337505050565b5f618ad58385616ff1565b93507f07ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff831115618b0857618b07618abd565b5b602083029250618b19838584618ac1565b82840190509392505050565b5f6040820190508181035f830152618b3e818688618a62565b90508181036020830152618b53818486618aca565b905095945050505050565b7f4552433732313a207472616e736665722066726f6d20696e636f7272656374205f8201527f6f776e6572000000000000000000000000000000000000000000000000000000602082015250565b5f618bb8602583616e9d565b9150618bc382618b5e565b604082019050919050565b5f6020820190508181035f830152618be581618bac565b9050919050565b7f4552433732313a207472616e7366657220746f20746865207a65726f206164645f8201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b5f618c46602483616e9d565b9150618c5182618bec565b604082019050919050565b5f6020820190508181035f830152618c7381618c3a565b9050919050565b7f5265656e7472616e637947756172643a207265656e7472616e742063616c6c005f82015250565b5f618cae601f83616e9d565b9150618cb982618c7a565b602082019050919050565b5f6020820190508181035f830152618cdb81618ca2565b9050919050565b7f4d757374206265207265676973746572656420657874656e73696f6e000000005f82015250565b5f618d16601c83616e9d565b9150618d2182618ce2565b602082019050919050565b5f6020820190508181035f830152618d4381618d0a565b9050919050565b5f618d5482616f23565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203618d8657618d85618290565b5b600182019050919050565b618d9a82616e93565b67ffffffffffffffff811115618db357618db2617794565b5b618dbd8254617f51565b618dc88282856188b7565b5f60209050601f831160018114618df9575f8415618de7578287015190505b618df18582618925565b865550618e58565b601f198416618e07866187ac565b5f5b82811015618e2e57848901518255600182019150602085019450602081019050618e09565b86831015618e4b5784890151618e47601f891682618909565b8355505b6001600288020188555050505b505050505050565b7f4d6f7265207468616e203120726f79616c7479207265636569766572000000005f82015250565b5f618e94601c83616e9d565b9150618e9f82618e60565b602082019050919050565b5f6020820190508181035f830152618ec181618e88565b9050919050565b5f618ed282616f23565b9150618edd83616f23565b9250828202618eeb81616f23565b91508282048414831517618f0257618f01618290565b5b5092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b5f618f4082616f23565b9150618f4b83616f23565b925082618f5b57618f5a618f09565b5b828204905092915050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e65725f82015250565b5f618f9a602083616e9d565b9150618fa582618f66565b602082019050919050565b5f6020820190508181035f830152618fc781618f8e565b9050919050565b7f546f6f206d616e7920657874656e73696f6e73000000000000000000000000005f82015250565b5f619002601383616e9d565b915061900d82618fce565b602082019050919050565b5f6020820190508181035f83015261902f81618ff6565b9050919050565b5f61904082617a72565b915061ffff820361905457619053618290565b5b600182019050919050565b7f496e697469616c697a61626c653a20636f6e7472616374206973206e6f7420695f8201527f6e697469616c697a696e67000000000000000000000000000000000000000000602082015250565b5f6190b9602b83616e9d565b91506190c48261905f565b604082019050919050565b5f6020820190508181035f8301526190e6816190ad565b9050919050565b7f4552433732313a20617070726f766520746f2063616c6c6572000000000000005f82015250565b5f619121601983616e9d565b915061912c826190ed565b602082019050919050565b5f6020820190508181035f83015261914e81619115565b9050919050565b7f4552433732313a207472616e7366657220746f206e6f6e2045524337323152655f8201527f63656976657220696d706c656d656e7465720000000000000000000000000000602082015250565b5f6191af603283616e9d565b91506191ba82619155565b604082019050919050565b5f6020820190508181035f8301526191dc816191a3565b9050919050565b5f67ffffffffffffffff8211156191fd576191fc617794565b5b602082029050602081019050919050565b5f8151905061921c81618a16565b92915050565b5f61923461922f846191e3565b6177f2565b90508083825260208201905060208402830185811115619257576192566170c6565b5b835b81811015619280578061926c888261920e565b845260208401935050602081019050619259565b5050509392505050565b5f82601f83011261929e5761929d6170be565b5b81516192ae848260208601619222565b91505092915050565b5f67ffffffffffffffff8211156192d1576192d0617794565b5b602082029050602081019050919050565b5f815190506192f081616f2c565b92915050565b5f619308619303846192b7565b6177f2565b9050808382526020820190506020840283018581111561932b5761932a6170c6565b5b835b81811015619354578061934088826192e2565b84526020840193505060208101905061932d565b5050509392505050565b5f82601f830112619372576193716170be565b5b81516193828482602086016192f6565b91505092915050565b5f80604083850312156193a1576193a0616d53565b5b5f83015167ffffffffffffffff8111156193be576193bd616d57565b5b6193ca8582860161928a565b925050602083015167ffffffffffffffff8111156193eb576193ea616d57565b5b6193f78582860161935e565b9150509250929050565b5f81905092915050565b5f815461941781617f51565b6194218186619401565b9450600182165f811461943b576001811461945057619482565b60ff1983168652811515820286019350619482565b619459856187ac565b5f5b8381101561947a5781548189015260018201915060208101905061945b565b838801955050505b50505092915050565b5f619496828561940b565b91506194a2828461940b565b91508190509392505050565b5f6194c06194bb8461780c565b6177f2565b9050828152602081018484840111156194dc576194db617790565b5b6194e7848285616ead565b509392505050565b5f82601f830112619503576195026170be565b5b81516195138482602086016194ae565b91505092915050565b5f6020828403121561953157619530616d53565b5b5f82015167ffffffffffffffff81111561954e5761954d616d57565b5b61955a848285016194ef565b91505092915050565b5f61956d82616e93565b6195778185619401565b9350619587818560208601616ead565b80840191505092915050565b5f61959e828561940b565b91506195aa8284619563565b91508190509392505050565b7f43726561746f72436f72653a20496e76616c696420657874656e73696f6e00005f82015250565b5f6195ea601e83616e9d565b91506195f5826195b6565b602082019050919050565b5f6020820190508181035f830152619617816195de565b9050919050565b7f496e76616c6964206164647265737300000000000000000000000000000000005f82015250565b5f619652600f83616e9d565b915061965d8261961e565b602082019050919050565b5f6020820190508181035f83015261967f81619646565b9050919050565b7f496e76616c696420746f74616c20726f79616c746965730000000000000000005f82015250565b5f6196ba601783616e9d565b91506196c582619686565b602082019050919050565b5f6020820190508181035f8301526196e7816196ae565b9050919050565b5f6020828403121561970357619702616d53565b5b5f61971084828501618a2c565b91505092915050565b5f60608201905061972c5f830186616f81565b6197396020830185616f81565b6197466040830184617307565b949350505050565b5f61975882616f23565b915061976383616f23565b925082820390508181111561977b5761977a618290565b5b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603160045260245ffd5b7f496e76616c6964000000000000000000000000000000000000000000000000005f82015250565b5f6197e2600783616e9d565b91506197ed826197ae565b602082019050919050565b5f6020820190508181035f83015261980f816197d6565b9050919050565b5f81519050919050565b5f82825260208201905092915050565b5f61983a82619816565b6198448185619820565b9350619854818560208601616ead565b61985d81616ebb565b840191505092915050565b5f60808201905061987b5f830187616f81565b6198886020830186616f81565b6198956040830185617307565b81810360608301526198a78184619830565b905095945050505050565b5f815190506198c081616d86565b92915050565b5f602082840312156198db576198da616d53565b5b5f6198e8848285016198b2565b91505092915050565b7f4552433732313a206d696e7420746f20746865207a65726f20616464726573735f82015250565b5f619925602083616e9d565b9150619930826198f1565b602082019050919050565b5f6020820190508181035f83015261995281619919565b9050919050565b7f4552433732313a20746f6b656e20616c7265616479206d696e746564000000005f82015250565b5f61998d601c83616e9d565b915061999882619959565b602082019050919050565b5f6020820190508181035f8301526199ba81619981565b9050919050565b6199ca81616d5b565b82525050565b5f6020820190506199e35f8301846199c1565b92915050565b5f6080820190506199fc5f830187616f81565b619a096020830186616f81565b619a166040830185616f81565b619a236060830184617307565b95945050505050565b5f81519050619a3a81617643565b92915050565b5f60208284031215619a5557619a54616d53565b5b5f619a6284828501619a2c565b91505092915050565b7f457874656e73696f6e20617070726f76616c206661696c7572650000000000005f82015250565b5f619a9f601a83616e9d565b9150619aaa82619a6b565b602082019050919050565b5f6020820190508181035f830152619acc81619a93565b905091905056fea26469706673582212202b995ada231fa8bf91509dc1b857a400a22f3c20e1d626a86a35b8c93df2cf2564736f6c634300081a0033").unwrap(); // Replace with actual bytecode
        let address = Address::from_str("0xcB28749c24AF4797808364D71d71539bc01E76d4").unwrap();

        // Create a test call
        let test_call = Call {
            caller: Address::from_str("0x1000000000000000000000000000000000000000").unwrap(),
            calldata: Bytes::from_str(
                "0x6352211e0000000000000000000000000000000000000000000000000000000000000001",
            )
            .unwrap(),
            value: U256::from(0),
        };

        // Execute the call
        let results = execute_calldatas_fork(bytecode, address, vec![test_call])
            .await
            .unwrap();
        println!("{:?}", results);
        // Assertions
        assert_eq!(results.len(), 1);
        let execution_result = &results[0];

        // Check that the call was successful
        assert_eq!(execution_result.exit_reason, InstructionResult::Return);
        assert!(!execution_result.reverted);

        // You might want to add more specific assertions based on what you expect from the call
        // For example, checking the return data, gas used, or logs emitted
        assert!(execution_result.gas_used > 0);
        // assert_eq!(execution_result.result, expected_result);
        // assert!(!execution_result.logs.is_empty());
    }

    #[tokio::test(flavor = "multi_thread")]
    async fn test_simple_storage_contract() {
        // Simple storage contract bytecode
        let bytecode = Bytes::from_str("0x608060405234801561000f575f80fd5b506004361061004a575f3560e01c80632a1afcd91461004e57806342cbb15c1461006c57806360fe47b11461008a5780636d4ce63c146100a6575b5f80fd5b6100566100c4565b6040516100639190610130565b60405180910390f35b6100746100c9565b6040516100819190610130565b60405180910390f35b6100a4600480360381019061009f9190610177565b6100d0565b005b6100ae610110565b6040516100bb9190610130565b60405180910390f35b5f5481565b5f43905090565b805f819055507fe0dca1a932506e28dc1cd7f50b0604489287b36ba09c37f13b25ee518d813528816040516101059190610130565b60405180910390a150565b5f8054905090565b5f819050919050565b61012a81610118565b82525050565b5f6020820190506101435f830184610121565b92915050565b5f80fd5b61015681610118565b8114610160575f80fd5b50565b5f813590506101718161014d565b92915050565b5f6020828403121561018c5761018b610149565b5b5f61019984828501610163565b9150509291505056fea2646970667358221220f7399e877793618afbf93c1ab591511f69fa1330a3fd5526ff45418127a04af964736f6c634300081a0033").unwrap();
        let address = Address::from_str("0xb2f9974c62815d3177079e150377915d9bc49c82").unwrap();

        // Call to store a value
        let store_call = Call {
            caller: Address::from_str("0x1000000000000000000000000000000000000000").unwrap(),
            calldata: Bytes::from_str(
                "0x60fe47b10000000000000000000000000000000000000000000000000000000000000001", // set 1
            )
            .unwrap(), // store(66)
            value: U256::from(0),
        };

        // Call to retrieve the value
        let retrieve_call = Call {
            caller: Address::from_str("0x1000000000000000000000000000000000000000").unwrap(),
            calldata: Bytes::from_str("0x6d4ce63c").unwrap(), // get()
            value: U256::from(0),
        };

        // Execute the calls
        let results = execute_calldatas_fork(bytecode, address, vec![store_call, retrieve_call])
            .await
            .unwrap();

        for (i, result) in results.iter().enumerate() {
            println!("Call {}", i);
            println!("Result data: 0x{}", hex::encode(&result.result));
            println!("Gas used: {}", result.gas_used);
            println!("Exit reason: {:?}", result.exit_reason);
            println!("Reverted: {}", result.reverted);
            println!("---");
        }

        // Check the retrieve call result
        assert_eq!(
            hex::encode(&results[1].result),
            "0000000000000000000000000000000000000000000000000000000000000001"
        );
    }
}
